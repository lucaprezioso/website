<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Luxury Obsession | Ferrari Experiences in Switzerland</title>
    <meta name="description" content="Ferrari only luxury experiences in Switzerland. Ferrari 458 Italia available now. Choose a package, check availability, and request your booking." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content="Luxury Obsession | Ferrari Experiences in Switzerland" />
    <meta property="og:description" content="Ferrari only luxury experiences in Switzerland. Ferrari 458 Italia available now." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="images/image00100.jpg" />
    <link rel="icon" href="images/image00600.jpg" />

    <link rel="alternate" hreflang="en" href="home.html?lang=en" />
    <link rel="alternate" hreflang="de" href="home.html?lang=de" />
    <link rel="alternate" hreflang="it" href="home.html?lang=it" />
    <link rel="alternate" hreflang="x-default" href="home.html?lang=en" />

    <style>
      :root{
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        --bg:#050509; --accent:#e50914; --accentSoft: rgba(229,9,20,0.16);
        --text:#f5f5f5; --muted:#a3a3a3; --border:#262637;
        --radius:18px; --shadow: 0 18px 45px rgba(0,0,0,0.4); --max:1120px;
      }
      *{box-sizing:border-box}
      body{margin:0;background: radial-gradient(circle at top, #191621 0, var(--bg) 55%); color:var(--text)}
      a{color:inherit;text-decoration:none}
      header{
        position:sticky; top:0; z-index:50;
        backdrop-filter: blur(12px);
        background: linear-gradient(to bottom, rgba(5,5,9,0.92), rgba(5,5,9,0.62), transparent);
        border-bottom: 1px solid rgba(255,255,255,0.03);
      }
      .container{max-width:var(--max);margin:0 auto;padding:0 1.5rem}
      .navInner{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:0.75rem 0}
      .brand{display:inline-flex;align-items:center;gap:0.75rem;font-size:0.95rem;letter-spacing:0.16em;text-transform:uppercase}
      .brandMark{
        width:30px;height:30px;border-radius:999px;
        background: radial-gradient(circle at 30% 30%, #ff5a5a, #7b0209);
        box-shadow: 0 0 20px rgba(229, 9, 20, 0.7);
        display:grid;place-items:center;font-weight:850;font-size:0.8rem
      }
      .navRight{display:flex;align-items:center;gap:0.65rem}
      .navLinks{display:flex;align-items:center;gap:0.8rem;font-size:0.9rem}
      .navLinks a{padding:0.35rem 0.65rem;border-radius:999px;color:var(--muted);transition:0.2s}
      .navLinks a:hover{color:var(--text);background:rgba(255,255,255,0.05)}
      .navCta{
        padding:0.45rem 0.9rem;border-radius:999px;background:var(--accent);
        font-size:0.85rem;font-weight:800;color:#fff;box-shadow:0 10px 26px rgba(229,9,20,0.45)
      }
      .langPicker{display:inline-flex;align-items:center;gap:0.35rem}
      .flagBtn{
        border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04);
        border-radius:999px;padding:0.25rem 0.45rem;cursor:pointer;font-size:1rem;line-height:1;opacity:0.75
      }
      .flagBtn.active{opacity:1;border-color:rgba(229,9,20,0.55);box-shadow:0 0 0 1px rgba(229,9,20,0.25)}
      .hamburger{
        display:none;width:42px;height:38px;border-radius:999px;border:1px solid rgba(255,255,255,0.14);
        background:rgba(255,255,255,0.04);cursor:pointer;align-items:center;justify-content:center
      }
      .hamburgerLines{display:grid;gap:4px}
      .hamburgerLines span{width:18px;height:2px;border-radius:999px;background:rgba(245,245,245,0.92);display:block}
      .mobileMenu{
        margin:0.65rem 0 0.95rem;padding:0.85rem;border-radius:16px;background:rgba(5,5,9,0.92);
        border:1px solid rgba(255,255,255,0.10);box-shadow:var(--shadow)
      }
      .mobileMenu a{display:flex;align-items:center;justify-content:space-between;padding:0.7rem 0.75rem;border-radius:12px}
      .mobileMenu a:hover{background:rgba(255,255,255,0.05)}
      .mobileMenuDivider{height:1px;background:rgba(255,255,255,0.08);margin:0.55rem 0}
      .mobileMenuCta{display:flex;justify-content:center;padding:0.75rem 0.85rem;border-radius:14px;background:var(--accent);font-weight:800;color:#fff;box-shadow:0 10px 26px rgba(229,9,20,0.45)}

      main{padding-bottom:2.2rem}
      section{padding:3.4rem 0}
      .eyebrow{text-transform:uppercase;letter-spacing:0.24em;font-size:0.7rem;color:var(--muted);margin-bottom:0.75rem}
      .hero{padding-top:2.2rem}
      .heroGrid{display:grid;grid-template-columns:minmax(0,1.35fr) minmax(0,1fr);gap:2.4rem;align-items:center}
      .heroTitle{font-size:clamp(2.35rem, 3.2vw + 1rem, 3.55rem);line-height:1.05;margin:0 0 0.75rem}
      .heroHighlight{background:linear-gradient(to right,#ff7676,#ffb199);-webkit-background-clip:text;background-clip:text;color:transparent}
      .heroSubtitle{font-size:1.05rem;color:var(--muted);max-width:38rem}
      .heroPills{margin-top:1.6rem;display:flex;flex-wrap:wrap;gap:0.6rem}
      .heroPill{border-radius:999px;padding:0.3rem 0.8rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-size:0.75rem;color:var(--muted)}
      .heroActions{margin-top:1.9rem;display:flex;flex-wrap:wrap;gap:0.9rem;align-items:center}
      .btn{border-radius:999px;padding:0.8rem 1.25rem;border:none;outline:none;font-weight:800;cursor:pointer;font-size:0.95rem;display:inline-flex;align-items:center;gap:0.45rem;white-space:nowrap}
      .btnPrimary{background:linear-gradient(135deg,var(--accent),#ff3b3b);color:#fff;box-shadow:0 15px 35px rgba(229,9,20,0.45)}
      .btnSecondary{background:rgba(255,255,255,0.02);color:var(--muted);border:1px solid rgba(255,255,255,0.12)}
      .heroNote{margin-top:1.05rem;font-size:0.82rem;color:var(--muted);line-height:1.6}

      .heroMediaCard{border-radius:32px;overflow:hidden;background:radial-gradient(circle at top left,#ff4949,#050509 52%);box-shadow:var(--shadow);position:relative;min-height:300px;border:1px solid rgba(255,255,255,0.10)}
      .heroMediaCard video,.heroMediaCard img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.08);filter:saturate(1.06) contrast(1.05)}
      .heroBadge{position:absolute;bottom:1.15rem;left:1.25rem;right:1.25rem;background:rgba(5,5,9,0.78);padding:0.55rem 0.85rem;border-radius:999px;display:flex;align-items:center;justify-content:space-between;gap:0.6rem;border:1px solid rgba(255,255,255,0.16);font-size:0.75rem}
      .heroBadgeDot{width:9px;height:9px;border-radius:999px;background:#4ade80;box-shadow:0 0 12px rgba(74,222,128,0.9)}
      .sectionTitle{font-size:1.75rem;margin:0 0 0.4rem}
      .sectionSubtitle{font-size:0.95rem;color:var(--muted);max-width:52rem;margin:0}
      .card{background:radial-gradient(circle at top left,#151520,#050509 55%);border-radius:var(--radius);border:1px solid var(--border);padding:1.3rem;box-shadow:var(--shadow)}
      .pricingGrid{margin-top:2rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:1.2rem}
      .pricingCard h3{margin:0 0 0.25rem;font-size:1.05rem}
      .pricingPrice{display:flex;align-items:baseline;gap:0.2rem;margin:0.35rem 0 0.45rem}
      .pricingPrice span:first-child{font-size:1.55rem;font-weight:900}
      .pricingKm{font-size:0.82rem;color:var(--muted)}
      .pricingTag{display:inline-block;margin-top:0.35rem;font-size:0.72rem;padding:0.2rem 0.6rem;border-radius:999px;background:var(--accentSoft);color:#ffb4b4}
      .pricingNote{font-size:0.8rem;color:var(--muted);margin-top:1.25rem}

      .bookingLayout{display:grid;grid-template-columns:minmax(0,1.05fr) minmax(0,0.95fr);gap:1.6rem;margin-top:2rem}
      .calendar{width:100%;border-collapse:collapse;font-size:0.85rem}
      .calendar th,.calendar td{text-align:center;padding:0.45rem}
      .calendar th{font-weight:650;color:var(--muted)}
      .calendar td{border-radius:10px;cursor:pointer;transition:0.15s}
      .calendar td.empty{cursor:default}
      .calendar td.available:hover{background:rgba(255,255,255,0.06)}
      .calendar td.unavailable{color:#555;text-decoration:line-through;cursor:not-allowed;opacity:0.6}
      .calendar td.partial{cursor:pointer;border:1px dashed rgba(229,9,20,0.55);background:rgba(229,9,20,0.10)}
      .calendar td.partial:hover{background:rgba(229,9,20,0.16)}
      .calendar td.selected{background:var(--accent);color:#fff;box-shadow:0 0 0 1px rgba(255,255,255,0.25);border:1px solid rgba(255,255,255,0.18)}
      .calendarHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem;font-size:0.9rem;gap:0.6rem}
      .calendarHeader button{border-radius:999px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.03);padding:0.25rem 0.65rem;color:var(--muted);cursor:pointer;font-size:0.8rem}
      .calendarLegend{margin-top:0.75rem;font-size:0.75rem;color:var(--muted);display:flex;flex-wrap:wrap;gap:0.75rem}
      .calendarLegendItem{display:inline-flex;align-items:center;gap:0.35rem}
      .legendDot{width:10px;height:10px;border-radius:999px}
      .legendDotAvail{background:rgba(255,255,255,0.18)}
      .legendDotUnavail{background:#4b5563}
      .legendDotPartial{background:rgba(229,9,20,0.30);border:1px dashed rgba(229,9,20,0.65)}
      .legendDotSelected{background:var(--accent)}
      .bookingForm{display:grid;gap:0.75rem;font-size:0.9rem}
      .fieldGroup{display:flex;flex-direction:column;gap:0.25rem}
      label{font-size:0.8rem;color:var(--muted)}
      input,select,textarea{
        border-radius:10px;border:1px solid var(--border);background:rgba(10,10,18,0.9);
        padding:0.5rem 0.7rem;color:var(--text);font-family:inherit;font-size:0.9rem;outline:none
      }
      input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 1px rgba(229,9,20,0.5)}
      textarea{min-height:84px;resize:vertical}
      .inlineFields{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:0.75rem}
      .couponRow{display:grid;grid-template-columns:minmax(0,1fr) auto;gap:0.65rem;align-items:end}
      .applyBtn{
        border-radius:10px;padding:0.55rem 0.9rem;border:1px solid rgba(255,255,255,0.14);
        background:rgba(255,255,255,0.04);color:var(--text);cursor:pointer;font-size:0.85rem;font-weight:900
      }
      .applyBtn:disabled{cursor:not-allowed;opacity:0.6}
      .helper{font-size:0.78rem;color:var(--muted);margin:0.15rem 0 0}
      .success{margin-top:0.35rem;font-size:0.82rem;color:#4ade80}
      .error{margin-top:0.35rem;font-size:0.82rem;color:#f97373}
      footer{border-top:1px solid rgba(255,255,255,0.08);padding:1.5rem 0;font-size:0.78rem;color:var(--muted)}
      .footerInner{display:flex;flex-wrap:wrap;justify-content:space-between;gap:1rem}
      @media(max-width:980px){.heroGrid,.bookingLayout{grid-template-columns:1fr}.heroMediaCard{max-width:640px;margin:0 auto}}
      @media(max-width:760px){.navLinks{display:none}.hamburger{display:inline-flex}.container{padding:0 1rem}}
      @media(max-width:560px){
        .pricingGrid{grid-auto-flow:column;grid-auto-columns:minmax(240px,1fr);grid-template-columns:unset;overflow-x:auto;-webkit-overflow-scrolling:touch;scroll-snap-type:x mandatory;padding-bottom:0.75rem}
        .pricingCard{scroll-snap-align:start}
        .pricingPrice span:first-child{font-size:1.8rem}
      }
    </style>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      const DATA = {
        booking: "data/booking.xlsx",
        coupon: "data/coupon.xlsx",
        package: "data/package.xlsx"
      };

      const CARS = [
        { id: "458", name: "Ferrari 458 Italia", status: "available" },
        { id: "portofino", name: "Ferrari Portofino", status: "soon" },
        { id: "296", name: "Ferrari 296 Spider", status: "soon" }
      ];

      const I18N = {
        en: {
          navGarage: "Garage",
          navPricing: "Pricing",
          navAvailability: "Availability",
          navBlog: "Blog",
          navContact: "Contact",
          navRequest: "Request date",
          menuOpen: "Open menu",
          menuClose: "Close menu",

          eyebrow: "Ferrari only luxury experiences in Switzerland",
          heroTitleA: "Luxury",
          heroTitleB: "Ferrari experiences",
          heroSubtitle: "A Ferrari only service built around taste, discipline, and real driving pleasure. Choose a package, check availability, and request your booking.",
          pill1: "Ferrari only fleet",
          pill2: "Private host",
          pill3: "Curated handover",
          pill4: "Transparent pricing",
          ctaGarage: "Explore garage and pricing",
          ctaBooking: "Check dates and request",
          currentSelection: "Available now:",
          availabilityNote: "Ferrari 458 Italia is currently available. Other models are listed as coming soon.",

          pricingTitle: "Packages preview",
          pricingSubtitle: "Loaded from data/package.xlsx. Swipe on mobile.",
          pricingNote: "Deposit, options, and extra mileage are on the Garage and Pricing page.",

          bookingTitle: "Availability and booking request",
          bookingSubtitle: "Select a date, then send a booking request. No payment is taken on this page.",
          formTitle: "Request your date",
          selectedCar: "Selected car:",
          name: "Full name",
          email: "Email",
          phone: "Phone",
          package: "Rental package",
          coupon: "Coupon",
          couponPlaceholder: "Enter code",
          couponApply: "Apply",
          couponClear: "Clear",
          couponApplied: "Coupon applied",
          couponInvalid: "Coupon not valid",
          couponNeedsEmail: "Enter your email to validate this coupon",
          couponNeedsDate: "Select a date to validate this coupon",
          couponNeedsPackage: "Select a package to validate this coupon",
          couponLoading: "Loading coupons‚Ä¶",
          packagesLoading: "Loading packages‚Ä¶",
          estimatedTotal: "Estimated total",
          preferredDate: "Preferred date",
          pickupTime: "Pickup time",
          notes: "Use case and requirements",
          notesHint: "More detail means faster confirmation.",
          sendRequest: "Send booking request",
          errPickDate: "Select a preferred date in the calendar first.",
          errRequired: "Name, email and package are required.",
          prepared: "Booking request prepared in your email client.",

          calPrev: "Previous",
          calNext: "Next",
          calLegendAvail: "Requestable",
          calLegendUnavail: "Unavailable or past",
          calLegendPartial: "Partially available",
          calLegendSelected: "Selected",
          weekdays: ["S", "M", "T", "W", "T", "F", "S"],
          locale: "en-GB",

          footerA: "Luxury Obsession.",
          footerB: "Ferrari only experiences, Switzerland."
        },
        de: {
          navGarage: "Garage",
          navPricing: "Preise",
          navAvailability: "Verf√ºgbarkeit",
          navBlog: "Blog",
          navContact: "Kontakt",
          navRequest: "Datum anfragen",
          menuOpen: "Men√º √∂ffnen",
          menuClose: "Men√º schliessen",

          eyebrow: "Ferrari only Luxury Erlebnisse in der Schweiz",
          heroTitleA: "Luxury",
          heroTitleB: "Ferrari Erlebnisse",
          heroSubtitle: "Ein Ferrari only Service mit Geschmack, Disziplin und echter Fahrfreude. Paket w√§hlen, Verf√ºgbarkeit pr√ºfen, Anfrage senden.",
          pill1: "Nur Ferrari",
          pill2: "Privater Host",
          pill3: "Kuratiertes Handover",
          pill4: "Transparente Preise",
          ctaGarage: "Garage und Preise ansehen",
          ctaBooking: "Datum pr√ºfen und anfragen",
          currentSelection: "Jetzt verf√ºgbar:",
          availabilityNote: "Ferrari 458 Italia verf√ºgbar. Weitere Modelle kommen bald.",

          pricingTitle: "Paket √úbersicht",
          pricingSubtitle: "Aus data/package.xlsx geladen. Auf Mobile wischen.",
          pricingNote: "Kaution, Optionen und Zusatzkilometer auf der Garage und Preise Seite.",

          bookingTitle: "Verf√ºgbarkeit und Anfrage",
          bookingSubtitle: "Datum w√§hlen, dann Anfrage senden. Keine Zahlung auf dieser Seite.",
          formTitle: "Datum anfragen",
          selectedCar: "Gew√§hltes Auto:",
          name: "Name",
          email: "E Mail",
          phone: "Telefon",
          package: "Paket",
          coupon: "Coupon",
          couponPlaceholder: "Code eingeben",
          couponApply: "Anwenden",
          couponClear: "L√∂schen",
          couponApplied: "Coupon angewendet",
          couponInvalid: "Coupon nicht g√ºltig",
          couponNeedsEmail: "Bitte E Mail eingeben, um Coupon zu pr√ºfen",
          couponNeedsDate: "Bitte Datum w√§hlen, um Coupon zu pr√ºfen",
          couponNeedsPackage: "Bitte Paket w√§hlen, um Coupon zu pr√ºfen",
          couponLoading: "Coupons laden‚Ä¶",
          packagesLoading: "Pakete laden‚Ä¶",
          estimatedTotal: "Gesch√§tzter Total",
          preferredDate: "Wunschtermin",
          pickupTime: "Abholzeit",
          notes: "Use Case und Anforderungen",
          notesHint: "Mehr Details bedeutet schnellere Best√§tigung.",
          sendRequest: "Anfrage senden",
          errPickDate: "Bitte zuerst ein Datum im Kalender w√§hlen.",
          errRequired: "Name, E Mail und Paket sind erforderlich.",
          prepared: "Anfrage wurde im E Mail Programm vorbereitet.",

          calPrev: "Zur√ºck",
          calNext: "Weiter",
          calLegendAvail: "Anfragbar",
          calLegendUnavail: "Nicht verf√ºgbar oder Vergangenheit",
          calLegendPartial: "Teilweise verf√ºgbar",
          calLegendSelected: "Ausgew√§hlt",
          weekdays: ["S", "M", "D", "M", "D", "F", "S"],
          locale: "de-CH",

          footerA: "Luxury Obsession.",
          footerB: "Ferrari only Erlebnisse, Schweiz."
        },
        it: {
          navGarage: "Garage",
          navPricing: "Prezzi",
          navAvailability: "Disponibilit√†",
          navBlog: "Blog",
          navContact: "Contatto",
          navRequest: "Richiedi data",
          menuOpen: "Apri menu",
          menuClose: "Chiudi menu",

          eyebrow: "Esperienze Luxury Ferrari only in Svizzera",
          heroTitleA: "Luxury",
          heroTitleB: "esperienze Ferrari",
          heroSubtitle: "Un servizio Ferrari only con gusto, disciplina e vera passione di guida. Scegli pacchetto, controlla disponibilit√†, invia richiesta.",
          pill1: "Solo Ferrari",
          pill2: "Host privato",
          pill3: "Handover curato",
          pill4: "Prezzi trasparenti",
          ctaGarage: "Scopri garage e prezzi",
          ctaBooking: "Controlla date e richiedi",
          currentSelection: "Disponibile ora:",
          availabilityNote: "Ferrari 458 Italia disponibile. Altri modelli in arrivo.",

          pricingTitle: "Anteprima pacchetti",
          pricingSubtitle: "Caricati da data/package.xlsx. Su mobile scorri.",
          pricingNote: "Deposito, opzioni e extra km nella pagina Garage e Prezzi.",

          bookingTitle: "Disponibilit√† e richiesta",
          bookingSubtitle: "Seleziona una data, poi invia la richiesta. Nessun pagamento su questa pagina.",
          formTitle: "Richiedi la data",
          selectedCar: "Auto selezionata:",
          name: "Nome completo",
          email: "Email",
          phone: "Telefono",
          package: "Pacchetto",
          coupon: "Coupon",
          couponPlaceholder: "Inserisci codice",
          couponApply: "Applica",
          couponClear: "Rimuovi",
          couponApplied: "Coupon applicato",
          couponInvalid: "Coupon non valido",
          couponNeedsEmail: "Inserisci la tua email per validare il coupon",
          couponNeedsDate: "Seleziona una data per validare il coupon",
          couponNeedsPackage: "Seleziona un pacchetto per validare il coupon",
          couponLoading: "Caricamento coupon‚Ä¶",
          packagesLoading: "Caricamento pacchetti‚Ä¶",
          estimatedTotal: "Totale stimato",
          preferredDate: "Data preferita",
          pickupTime: "Ora ritiro",
          notes: "Caso d uso e richieste",
          notesHint: "Pi√π dettagli significa conferma pi√π rapida.",
          sendRequest: "Invia richiesta",
          errPickDate: "Seleziona prima una data nel calendario.",
          errRequired: "Nome, email e pacchetto sono obbligatori.",
          prepared: "Richiesta preparata nel client email.",

          calPrev: "Indietro",
          calNext: "Avanti",
          calLegendAvail: "Richiedibile",
          calLegendUnavail: "Non disponibile o passato",
          calLegendPartial: "Parzialmente disponibile",
          calLegendSelected: "Selezionato",
          weekdays: ["D", "L", "M", "M", "G", "V", "S"],
          locale: "it-CH",

          footerA: "Luxury Obsession.",
          footerB: "Esperienze solo Ferrari, Svizzera."
        }
      };

      function getParam(name){const params=new URLSearchParams(window.location.search);return params.get(name);}
      function setParamReplace(name,value){const url=new URL(window.location.href);if(!value) url.searchParams.delete(name); else url.searchParams.set(name,value); window.history.replaceState({}, "", url.toString());}
      function readLang(){const fromUrl=getParam("lang"); if(fromUrl && I18N[fromUrl]) return fromUrl; const fromStore=localStorage.getItem("lo_lang"); if(fromStore && I18N[fromStore]) return fromStore; return "en";}

      function buildUrl(path, lang, hash){
        const url = new URL(path, window.location.href);
        url.searchParams.set("lang", lang);
        if(hash) url.hash = hash;
        return url.pathname + url.search + url.hash;
      }

      function pad2(n){return String(n).padStart(2,"0")}
      function toISO(d){return d ? `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}` : ""}

      function parseExcelDate(value){
        if(!value && value!==0) return null;
        if(value instanceof Date) return value;
        if(typeof value === "number"){
          const dc = window.XLSX?.SSF?.parse_date_code ? window.XLSX.SSF.parse_date_code(value) : null;
          if(dc && dc.y && dc.m && dc.d) return new Date(dc.y, dc.m-1, dc.d);
          const base = new Date(Date.UTC(1899,11,30));
          const guess = new Date(base.getTime() + value * 24*60*60*1000);
          return new Date(guess.getUTCFullYear(), guess.getUTCMonth(), guess.getUTCDate());
        }
        if(typeof value === "string"){
          const s = value.trim(); if(!s) return null;
          const d = new Date(s);
          if(!isNaN(d.getTime())) return new Date(d.getFullYear(), d.getMonth(), d.getDate());
        }
        return null;
      }
      function normalizeDateOnly(d){return d ? new Date(d.getFullYear(), d.getMonth(), d.getDate()) : null}
      function inRange(dateOnly, from, to){
        const d = normalizeDateOnly(dateOnly);
        const f = from ? normalizeDateOnly(from) : null;
        const t = to ? normalizeDateOnly(to) : null;
        if(!d) return false;
        if(f && d < f) return false;
        if(t && d > t) return false;
        return true;
      }
      function parseList(value){
        const s = String(value || "").trim();
        if(!s) return [];
        return s.split(/[;,]/).map(x => x.trim()).filter(Boolean);
      }
      function parseDiscount(discountRaw){
        if(discountRaw === null || discountRaw === undefined) return { type:"pct", value:0 };
        if(typeof discountRaw === "number"){
          if(discountRaw > 0 && discountRaw <= 1) return { type:"pct", value:discountRaw };
          if(discountRaw > 1 && discountRaw <= 100) return { type:"pct", value:discountRaw/100 };
          if(discountRaw > 100) return { type:"chf", value:discountRaw };
          return { type:"pct", value:0 };
        }
        const s = String(discountRaw || "").trim();
        if(!s) return { type:"pct", value:0 };
        const pct = s.match(/^(\d+(?:\.\d+)?)\s*%$/);
        if(pct) return { type:"pct", value: Math.max(0, Math.min(1, Number(pct[1])/100)) };
        const chf = s.match(/^(\d+(?:\.\d+)?)\s*CHF$/i);
        if(chf) return { type:"chf", value: Math.max(0, Number(chf[1])) };
        const n = Number(s);
        if(Number.isFinite(n)){
          if(n > 0 && n <= 1) return { type:"pct", value:n };
          if(n > 1 && n <= 100) return { type:"pct", value:n/100 };
          if(n > 100) return { type:"chf", value:n };
        }
        return { type:"pct", value:0 };
      }

      function useExcel(urlStr, mapRowFn){
        const [data, setData] = useState(null);
        const [loaded, setLoaded] = useState(false);
        const [error, setError] = useState("");
        useEffect(() => {
          let cancelled = false;
          async function load(){
            try{
              const res = await fetch(`${urlStr}?ts=${Date.now()}`);
              if(!res.ok) throw new Error("not found");
              const buf = await res.arrayBuffer();
              const wb = window.XLSX.read(buf, { type: "array" });
              const ws = wb.Sheets[wb.SheetNames[0]];
              const rows = window.XLSX.utils.sheet_to_json(ws, { defval: "" });
              const out = rows.map(mapRowFn).filter(Boolean);
              if(!cancelled){ setData(out); setLoaded(true); setError(""); }
            }catch(e){
              if(!cancelled){ setData(null); setLoaded(true); setError(String(e?.message || e)); }
            }
          }
          load();
          return () => { cancelled = true; };
        }, [urlStr]);
        return { data, loaded, error };
      }

      function useBookingStatuses(){
        return useExcel(DATA.booking, (row) => {
          const dateVal = row.date ?? row.Date ?? row.DATE ?? row["Date"] ?? row["DATE"];
          const stVal = row.status ?? row.Status ?? row.STATUS ?? "";
          const d = parseExcelDate(dateVal);
          if(!d) return null;
          const iso = toISO(d);
          const st = String(stVal || "").trim().toUpperCase();
          return { iso, st };
        });
      }

      function usePackages(){
        const fallback = [
          { package_id:"P6_L", duration:"6h", km:"80", pricing_chf:790, label_en:"Signature Half Day (6h, 80 km) ¬∑ 790 CHF", label_de:"Signature Halbtag (6h, 80 km) ¬∑ 790 CHF", label_it:"Signature Mezza giornata (6h, 80 km) ¬∑ 790 CHF", sort_order:10 },
          { package_id:"P6_U", duration:"6h", km:"Unlimited", pricing_chf:890, label_en:"Signature Half Day Unlimited (6h) ¬∑ 890 CHF", label_de:"Signature Halbtag Unlimited (6h) ¬∑ 890 CHF", label_it:"Signature Mezza giornata Unlimited (6h) ¬∑ 890 CHF", sort_order:20 },
          { package_id:"P12_L", duration:"12h", km:"150", pricing_chf:1290, label_en:"Grand Tour (12h, 150 km) ¬∑ 1290 CHF", label_de:"Grand Tour (12h, 150 km) ¬∑ 1290 CHF", label_it:"Grand Tour (12h, 150 km) ¬∑ 1290 CHF", sort_order:30 },
          { package_id:"P12_U", duration:"12h", km:"Unlimited", pricing_chf:1390, label_en:"Grand Tour Unlimited (12h) ¬∑ 1390 CHF", label_de:"Grand Tour Unlimited (12h) ¬∑ 1390 CHF", label_it:"Grand Tour Unlimited (12h) ¬∑ 1390 CHF", sort_order:40 },
          { package_id:"P24_L", duration:"24h", km:"250", pricing_chf:1490, label_en:"Full Day Icon (24h, 250 km) ¬∑ 1490 CHF", label_de:"Full Day Icon (24h, 250 km) ¬∑ 1490 CHF", label_it:"Full Day Icon (24h, 250 km) ¬∑ 1490 CHF", sort_order:50 },
        ];
        const { data, loaded, error } = useExcel(DATA.package, (row) => {
          const id = String(row.package_id ?? row.packageId ?? row.id ?? "").trim();
          if(!id) return null;
          const active = String(row.active ?? "").trim().toUpperCase();
          if(active === "N") return null;
          const duration = String(row.duration ?? "").trim();
          const km = String(row.km ?? "").trim();
          const price = Number(row.pricing_chf ?? row.price_chf ?? row.price ?? "");
          const sort = Number(row.sort_order ?? row.sort ?? 0);
          return {
            package_id: id,
            duration,
            km,
            pricing_chf: Number.isFinite(price) ? price : null,
            label_en: String(row.label_en ?? "").trim(),
            label_de: String(row.label_de ?? "").trim(),
            label_it: String(row.label_it ?? "").trim(),
            sort_order: Number.isFinite(sort) ? sort : 9999
          };
        });

        const packages = useMemo(() => {
          const src = (data && data.length) ? data : fallback;
          return [...src].sort((a,b) => (a.sort_order ?? 9999) - (b.sort_order ?? 9999));
        }, [data]);

        return { packages, loaded, error };
      }

      function useCoupons(){
        const { data, loaded, error } = useExcel(DATA.coupon, (row) => {
          const code = String(row.coupon ?? row.Coupon ?? "").trim().toUpperCase();
          if(!code) return null;
          const active = String(row.active ?? "").trim().toUpperCase();
          const user = String(row.user ?? "").trim().toLowerCase();
          const reqFrom = parseExcelDate(row.valid_from_request_date ?? "");
          const reqTo = parseExcelDate(row.valid_to_request_date ?? "");
          const bookFrom = parseExcelDate(row.valid_from_booked_date ?? "");
          const bookTo = parseExcelDate(row.valid_to_booked_date ?? "");
          const discount = parseDiscount(row.discount ?? "");
          const packageList = parseList(row.package ?? row.packages ?? "");
          return { code, active, user, reqFrom, reqTo, bookFrom, bookTo, discount, packageList };
        });

        const map = useMemo(() => {
          const out = {};
          for(const c of (data || [])) out[c.code] = c;
          return out;
        }, [data]);

        return { couponsByCode: map, loaded, error };
      }

      function validateCoupon({ codeInput, emailInput, requestDate, bookedDate, packageId, couponsByCode }){
        const code = String(codeInput || "").trim().toUpperCase();
        if(!code) return { ok:false, reason:"empty" };
        const row = couponsByCode && couponsByCode[code] ? couponsByCode[code] : null;
        if(!row) return { ok:false, reason:"not_found" };
        const active = String(row.active || "").trim().toUpperCase();
        if(active === "N") return { ok:false, reason:"inactive" };
        const email = String(emailInput || "").trim().toLowerCase();
        if(row.user && !email) return { ok:false, reason:"need_email" };
        if(row.user && email && row.user !== email) return { ok:false, reason:"wrong_user" };
        const reqDate = normalizeDateOnly(requestDate || new Date());
        if((row.reqFrom || row.reqTo) && !inRange(reqDate, row.reqFrom, row.reqTo)) return { ok:false, reason:"request_date_outside" };
        if(row.bookFrom || row.bookTo){
          if(!bookedDate) return { ok:false, reason:"need_date" };
          const b = normalizeDateOnly(bookedDate);
          if(!inRange(b, row.bookFrom, row.bookTo)) return { ok:false, reason:"booked_date_outside" };
        }
        if(row.packageList && row.packageList.length){
          if(!packageId) return { ok:false, reason:"need_package" };
          const allowed = row.packageList.map(x => x.toUpperCase());
          if(!allowed.includes(String(packageId).toUpperCase())) return { ok:false, reason:"wrong_package" };
        }
        const label = row.discount.type === "pct" ? `${Math.round(row.discount.value*100)}%` : `${Math.round(row.discount.value)} CHF`;
        return { ok:true, code, discount: row.discount, label };
      }

      function calcDiscounted(base, discount){
        if(!base || !discount) return { final: base, delta: 0 };
        if(discount.type === "pct"){
          const final = Math.round(base * (1 - discount.value));
          return { final, delta: Math.max(0, base - final) };
        }
        if(discount.type === "chf"){
          const final = Math.max(0, Math.round(base - discount.value));
          return { final, delta: Math.max(0, base - final) };
        }
        return { final: base, delta: 0 };
      }

      function LanguagePicker({ lang, onChange }){
        const items = [
          { code:"en", flag:"üá¨üáß", title:"English" },
          { code:"de", flag:"üá©üá™", title:"Deutsch" },
          { code:"it", flag:"üáÆüáπ", title:"Italiano" }
        ];
        return (
          <div className="langPicker" aria-label="Language">
            {items.map(it => (
              <button key={it.code} className={it.code === lang ? "flagBtn active" : "flagBtn"} title={it.title} onClick={() => onChange(it.code)} type="button">
                {it.flag}
              </button>
            ))}
          </div>
        );
      }

      function Nav({ lang, setLang, t }){
        const [open, setOpen] = useState(false);
        const close = () => setOpen(false);
        return (
          <header>
            <div className="container">
              <div className="navInner">
                <a href={buildUrl("home.html", lang, "top")} className="brand">
                  <div className="brandMark">LO</div><span>Luxury Obsession</span>
                </a>

                <div className="navRight">
                  <nav className="navLinks" aria-label="Primary">
                    <a href={buildUrl("subs/pricing.html", lang, "garage")}>{t.navGarage}</a>
                    <a href={buildUrl("subs/pricing.html", lang, "packages")}>{t.navPricing}</a>
                    <a href={buildUrl("home.html", lang, "booking")}>{t.navAvailability}</a>
                    <a href={buildUrl("subs/blog.html", lang)}>{t.navBlog}</a>
                    <a href={buildUrl("home.html", lang, "contact")}>{t.navContact}</a>
                    <a href={buildUrl("home.html", lang, "booking")} className="navCta">{t.navRequest}</a>
                  </nav>

                  <LanguagePicker lang={lang} onChange={(x) => { setLang(x); close(); }} />

                  <button type="button" className="hamburger" aria-label={open ? t.menuClose : t.menuOpen} aria-expanded={open ? "true" : "false"} onClick={() => setOpen(v => !v)}>
                    <div className="hamburgerLines" aria-hidden="true"><span></span><span></span><span></span></div>
                  </button>
                </div>
              </div>

              {open && (
                <div className="mobileMenu" role="navigation" aria-label="Mobile">
                  <a href={buildUrl("subs/pricing.html", lang, "garage")} onClick={close}>{t.navGarage}<span>‚Ä∫</span></a>
                  <a href={buildUrl("subs/pricing.html", lang, "packages")} onClick={close}>{t.navPricing}<span>‚Ä∫</span></a>
                  <a href={buildUrl("home.html", lang, "booking")} onClick={close}>{t.navAvailability}<span>‚Ä∫</span></a>
                  <a href={buildUrl("subs/blog.html", lang)} onClick={close}>{t.navBlog}<span>‚Ä∫</span></a>
                  <a href={buildUrl("home.html", lang, "contact")} onClick={close}>{t.navContact}<span>‚Ä∫</span></a>
                  <div className="mobileMenuDivider"></div>
                  <a className="mobileMenuCta" href={buildUrl("home.html", lang, "booking")} onClick={close}>{t.navRequest}</a>
                </div>
              )}
            </div>
          </header>
        );
      }

      function Hero({ lang, t }){
        const selected = CARS[0];
        return (
          <section id="top" className="hero">
            <div className="container heroGrid">
              <div>
                <div className="eyebrow">{t.eyebrow}</div>
                <h1 className="heroTitle">{t.heroTitleA} <span className="heroHighlight">{t.heroTitleB}</span></h1>
                <p className="heroSubtitle">{t.heroSubtitle}</p>

                <div className="heroPills">
                  <span className="heroPill">{t.pill1}</span>
                  <span className="heroPill">{t.pill2}</span>
                  <span className="heroPill">{t.pill3}</span>
                  <span className="heroPill">{t.pill4}</span>
                </div>

                <div className="heroActions">
                  <a href={buildUrl("subs/pricing.html", lang, "garage")} className="btn btnSecondary">{t.ctaGarage}</a>
                  <a href={buildUrl("home.html", lang, "booking")} className="btn btnPrimary">{t.ctaBooking}</a>
                </div>

                <p className="heroNote">
                  {t.currentSelection} <strong>{selected.name}</strong><br />
                  {t.availabilityNote}
                </p>
              </div>

              <div className="heroMediaCard" aria-label="Hero media">
                <video autoPlay muted loop playsInline poster="images/image00100.jpg">
                  <source src="videos/video00100.mp4" type="video/mp4" />
                </video>

                <div className="heroBadge">
                  <div style={{ display: "inline-flex", alignItems: "center", gap: "0.5rem" }}>
                    <span className="heroBadgeDot"></span>
                    <span>Taking booking requests</span>
                  </div>
                  <span>Switzerland</span>
                </div>
              </div>
            </div>
          </section>
        );
      }

      function PricingPreview({ t, packages, packagesLoaded, lang }){
        const tiers = packages.slice(0, 6).map((p) => {
          const kmLabel = String(p.km || "").toLowerCase() === "unlimited" ? "Unlimited" : `${p.km} km`;
          const tag = String(p.km || "").toLowerCase() === "unlimited" ? "Unlimited" : "Limited";
          const label = p[`label_${lang}`] || p.label_en || p.package_id;
          return { name: label.split(" ¬∑ ")[0], price: String(p.pricing_chf || "-"), km: kmLabel, tag };
        });

        return (
          <section id="pricing">
            <div className="container">
              <h2 className="sectionTitle">{t.pricingTitle}</h2>
              <p className="sectionSubtitle">{t.pricingSubtitle}</p>

              <div className="pricingGrid" aria-label="Package preview">
                {!packagesLoaded ? <div className="card">{t.packagesLoading}</div> :
                  tiers.map((x, idx) => (
                    <div className="card pricingCard" key={x.name + idx}>
                      <h3>{x.name}</h3>
                      <div className="pricingPrice"><span>{x.price}</span><span>CHF</span></div>
                      <div className="pricingKm">{x.km}</div>
                      <div className="pricingTag">{x.tag}</div>
                    </div>
                  ))
                }
              </div>

              <p className="pricingNote">{t.pricingNote}</p>
            </div>
          </section>
        );
      }

      function useCalendar(statusList, initialDate = new Date()){
        const statusByISO = useMemo(() => {
          const map = {};
          for(const row of (statusList || [])) map[row.iso] = row.st;
          return map;
        }, [statusList]);

        const [currentMonth, setCurrentMonth] = useState(new Date(initialDate.getFullYear(), initialDate.getMonth(), 1));
        const [selectedDate, setSelectedDate] = useState(null);

        const today = useMemo(() => { const t = new Date(); t.setHours(0,0,0,0); return t; }, []);

        function buildMatrix(){
          const year = currentMonth.getFullYear();
          const month = currentMonth.getMonth();
          const first = new Date(year, month, 1);
          const last = new Date(year, month + 1, 0);
          const firstWeekday = first.getDay();
          const daysInMonth = last.getDate();

          const cells = [];
          for(let i=0;i<firstWeekday;i++) cells.push(null);
          for(let d=1; d<=daysInMonth; d++) cells.push(new Date(year, month, d));
          while(cells.length % 7 !== 0) cells.push(null);

          const weeks = [];
          for(let i=0;i<cells.length;i+=7) weeks.push(cells.slice(i, i+7));
          return weeks;
        }

        function isPast(date){ return date ? date < today : false; }

        function getStatus(date){
          if(!date) return "EMPTY";
          if(isPast(date)) return "PAST";
          const iso = toISO(date);
          const st = (statusByISO && Object.prototype.hasOwnProperty.call(statusByISO, iso)) ? statusByISO[iso] : "";
          if(st === "N") return "N";
          if(st === "P") return "P";
          return "A";
        }

        function isSelectable(date){ const st = getStatus(date); return st === "A" || st === "P"; }

        function prevMonth(){ setCurrentMonth(m => new Date(m.getFullYear(), m.getMonth()-1, 1)); setSelectedDate(null); }
        function nextMonth(){ setCurrentMonth(m => new Date(m.getFullYear(), m.getMonth()+1, 1)); setSelectedDate(null); }

        return { currentMonth, selectedDate, setSelectedDate, daysMatrix: buildMatrix(), getStatus, isSelectable, prevMonth, nextMonth };
      }

      function Calendar({ calendar, t }){
        const monthLabel = calendar.currentMonth.toLocaleString(t.locale || "en-GB", { month:"long", year:"numeric" });
        function handleClick(date){
          if(!date) return;
          if(!calendar.isSelectable(date)) return;
          calendar.setSelectedDate(date);
        }
        const tooltip = (st) => {
          if(st === "P") return t.calLegendPartial;
          if(st === "N" || st === "PAST") return t.calLegendUnavail;
          if(st === "A") return t.calLegendAvail;
          return "";
        };

        return (
          <div className="card">
            <div className="calendarHeader">
              <button type="button" onClick={calendar.prevMonth}>{t.calPrev}</button>
              <div>{monthLabel}</div>
              <button type="button" onClick={calendar.nextMonth}>{t.calNext}</button>
            </div>

            <table className="calendar" aria-label="Availability calendar">
              <thead>
                <tr>{(t.weekdays || ["S","M","T","W","T","F","S"]).map(d => <th key={d}>{d}</th>)}</tr>
              </thead>
              <tbody>
                {calendar.daysMatrix.map((week, i) => (
                  <tr key={i}>
                    {week.map((date, j) => {
                      if(!date) return <td className="empty" key={j}></td>;
                      const st = calendar.getStatus(date);
                      const isSelected = calendar.selectedDate && date.getTime() === calendar.selectedDate.getTime();
                      const cls = [isSelected && "selected", st==="A" && "available", st==="P" && "partial", (st==="N" || st==="PAST") && "unavailable"].filter(Boolean).join(" ");
                      return (
                        <td key={j} className={cls} onClick={() => handleClick(date)} title={tooltip(st)}>
                          {date.getDate()}
                        </td>
                      );
                    })}
                  </tr>
                ))}
              </tbody>
            </table>

            <div className="calendarLegend" aria-label="Legend">
              <div className="calendarLegendItem"><span className="legendDot legendDotAvail"></span><span>{t.calLegendAvail}</span></div>
              <div className="calendarLegendItem"><span className="legendDot legendDotUnavail"></span><span>{t.calLegendUnavail}</span></div>
              <div className="calendarLegendItem"><span className="legendDot legendDotPartial"></span><span>{t.calLegendPartial}</span></div>
              <div className="calendarLegendItem"><span className="legendDot legendDotSelected"></span><span>{t.calLegendSelected}</span></div>
            </div>
          </div>
        );
      }

      function BookingForm({ selectedDate, selectedStatus, t, packages, packagesLoaded, couponsByCode, couponsLoaded, couponsError, lang }){
        const carObj = CARS[0];
        const [form, setForm] = useState({ name:"", email:"", phone:"", packageId:"", startTime:"", notes:"", couponInput:"" });
        const [status, setStatus] = useState(null);
        const [appliedCoupon, setAppliedCoupon] = useState(null);

        function handleChange(e){
          const { name, value } = e.target;
          setForm(f => ({ ...f, [name]: value }));
          setStatus(null);
          if(name === "packageId" || name === "email") setAppliedCoupon(null);
        }

        const selectedPackage = useMemo(() => packages.find(p => p.package_id === form.packageId) || null, [packages, form.packageId]);
        const basePrice = selectedPackage?.pricing_chf || 0;
        const estObj = useMemo(() => calcDiscounted(basePrice, appliedCoupon?.discount || null), [basePrice, appliedCoupon]);
        const estimate = basePrice ? `${estObj.final} CHF` : "";

        function applyCoupon(){
          setStatus(null);
          if(!couponsLoaded){ setStatus({ type:"error", msg:t.couponLoading }); return; }
          const code = (form.couponInput || "").trim();
          if(!code){ setAppliedCoupon(null); return; }
          const v = validateCoupon({
            codeInput: code,
            emailInput: form.email,
            requestDate: new Date(),
            bookedDate: selectedDate,
            packageId: form.packageId,
            couponsByCode
          });
          if(!v.ok){
            if(v.reason === "need_email") setStatus({ type:"error", msg:t.couponNeedsEmail });
            else if(v.reason === "need_date") setStatus({ type:"error", msg:t.couponNeedsDate });
            else if(v.reason === "need_package" || v.reason === "wrong_package") setStatus({ type:"error", msg:t.couponNeedsPackage });
            else setStatus({ type:"error", msg:t.couponInvalid });
            setAppliedCoupon(null);
            return;
          }
          setAppliedCoupon({ code: v.code, discount: v.discount, label: v.label });
          setStatus({ type:"success", msg:`${t.couponApplied}${v.label ? " ("+v.label+")" : ""}` });
        }

        function clearCoupon(){
          setAppliedCoupon(null);
          setForm(f => ({ ...f, couponInput:"" }));
          setStatus(null);
        }

        function handleSubmit(e){
          e.preventDefault();
          if(!selectedDate){ setStatus({ type:"error", msg:t.errPickDate }); return; }
          if(!form.name || !form.email || !form.packageId){ setStatus({ type:"error", msg:t.errRequired }); return; }

          const dateLabel = toISO(selectedDate);
          const subject = `Ferrari booking request for ${dateLabel}`;

          const pkgLabel = (selectedPackage && (selectedPackage[`label_${lang}`] || selectedPackage.label_en)) || form.packageId;

          const lines = [
            `Selected car: ${carObj.name}`,
            `Preferred date: ${dateLabel}`,
            `Availability status: ${selectedStatus === "P" ? "P" : "A"}`,
            `Name: ${form.name}`,
            `Email: ${form.email}`,
            `Phone: ${form.phone}`,
            `Package: ${pkgLabel} (id: ${form.packageId})`,
            `Pickup time: ${form.startTime}`,
            `Coupon: ${(appliedCoupon?.code || form.couponInput || "").trim()}`,
            `Estimated total: ${estimate || ""}`,
            `Notes: ${form.notes}`
          ];

          const body = encodeURIComponent(lines.join("\n"));
          window.location.href = `mailto:info@luxury-obsession.ch?subject=${encodeURIComponent(subject)}&body=${body}`;
          setStatus({ type:"success", msg:t.prepared });
        }

        return (
          <form className="card bookingForm" onSubmit={handleSubmit}>
            <h3 style={{ margin: 0 }}>{t.formTitle}</h3>
            <p className="helper">{t.selectedCar} <strong>{carObj.name}</strong></p>

            <div className="inlineFields">
              <div className="fieldGroup">
                <label htmlFor="name">{t.name}</label>
                <input id="name" name="name" value={form.name} onChange={handleChange} required />
              </div>
              <div className="fieldGroup">
                <label htmlFor="email">{t.email}</label>
                <input id="email" type="email" name="email" value={form.email} onChange={handleChange} required />
              </div>
            </div>

            <div className="inlineFields">
              <div className="fieldGroup">
                <label htmlFor="phone">{t.phone}</label>
                <input id="phone" name="phone" value={form.phone} onChange={handleChange} />
              </div>
              <div className="fieldGroup">
                <label htmlFor="packageId">{t.package}</label>
                <select id="packageId" name="packageId" value={form.packageId} onChange={handleChange} required disabled={!packagesLoaded}>
                  <option value="">{packagesLoaded ? "Select package" : t.packagesLoading}</option>
                  {packages.map(p => {
                    const label = p[`label_${lang}`] || p.label_en || `${p.duration} ¬∑ ${p.km} ¬∑ ${p.pricing_chf} CHF`;
                    return <option key={p.package_id} value={p.package_id}>{label}</option>;
                  })}
                </select>
              </div>
            </div>

            <div className="inlineFields">
              <div className="fieldGroup">
                <label>{t.preferredDate}</label>
                <input type="text" readOnly value={selectedDate ? selectedDate.toDateString() : ""} />
              </div>
              <div className="fieldGroup">
                <label htmlFor="startTime">{t.pickupTime}</label>
                <input id="startTime" name="startTime" type="time" value={form.startTime} onChange={handleChange} />
              </div>
            </div>

            <div className="inlineFields">
              <div className="fieldGroup">
                <label>{t.coupon}</label>
                <div className="couponRow">
                  <input id="couponInput" name="couponInput" value={form.couponInput} onChange={handleChange} placeholder={t.couponPlaceholder} autoComplete="off" />
                  <div style={{ display:"flex", gap:"0.45rem" }}>
                    <button type="button" className="applyBtn" onClick={applyCoupon} disabled={!form.couponInput.trim()}>{t.couponApply}</button>
                    <button type="button" className="applyBtn" onClick={clearCoupon} disabled={!form.couponInput.trim() && !appliedCoupon}>{t.couponClear}</button>
                  </div>
                </div>
                <p className="helper">{couponsError ? "coupon.xlsx not reachable" : ""}</p>
              </div>

              <div className="fieldGroup">
                <label>{t.estimatedTotal}</label>
                <input type="text" readOnly value={estimate} />
                {appliedCoupon && basePrice ? <p className="helper">Saved {estObj.delta} CHF</p> : <p className="helper">&nbsp;</p>}
              </div>
            </div>

            <div className="fieldGroup">
              <label htmlFor="notes">{t.notes}</label>
              <textarea id="notes" name="notes" value={form.notes} onChange={handleChange}></textarea>
              <p className="helper">{t.notesHint}</p>
            </div>

            <button type="submit" className="btn btnPrimary">{t.sendRequest}</button>
            {status && <div className={status.type === "success" ? "success" : "error"}>{status.msg}</div>}
          </form>
        );
      }

      function Booking({ t, bookingList, bookingLoaded, packages, packagesLoaded, couponsByCode, couponsLoaded, couponsError, lang }){
        const calendar = useCalendar(bookingList);
        const selectedStatus = calendar.selectedDate ? calendar.getStatus(calendar.selectedDate) : null;

        return (
          <section id="booking">
            <div className="container">
              <h2 className="sectionTitle">{t.bookingTitle}</h2>
              <p className="sectionSubtitle">{t.bookingSubtitle}</p>

              <div className="bookingLayout">
                <Calendar calendar={calendar} t={t} />
                <BookingForm
                  selectedDate={calendar.selectedDate}
                  selectedStatus={selectedStatus}
                  t={t}
                  packages={packages}
                  packagesLoaded={packagesLoaded}
                  couponsByCode={couponsByCode}
                  couponsLoaded={couponsLoaded}
                  couponsError={couponsError}
                  lang={lang}
                />
              </div>

              {!bookingLoaded && <p className="pricingNote">Loading availability from data/booking.xlsx‚Ä¶</p>}
            </div>
          </section>
        );
      }

      function App(){
        const [lang, _setLang] = useState(readLang());
        const t = I18N[lang] || I18N.en;

        const booking = useBookingStatuses();
        const pack = usePackages();
        const coupon = useCoupons();

        useEffect(() => {
          localStorage.setItem("lo_lang", lang);
          document.documentElement.lang = lang;
          setParamReplace("lang", lang);
        }, [lang]);

        function setLang(next){ if(!I18N[next]) return; _setLang(next); }

        const bookingList = booking.data || [];

        return (
          <div>
            <Nav lang={lang} setLang={setLang} t={t} />
            <main>
              <Hero lang={lang} t={t} />
              <PricingPreview t={t} packages={pack.packages} packagesLoaded={pack.loaded} lang={lang} />
              <Booking
                t={t}
                bookingList={bookingList}
                bookingLoaded={booking.loaded}
                packages={pack.packages}
                packagesLoaded={pack.loaded}
                couponsByCode={coupon.couponsByCode}
                couponsLoaded={coupon.loaded}
                couponsError={coupon.error}
                lang={lang}
              />

              <section id="contact">
                <div className="container">
                  <h2 className="sectionTitle">{t.navContact}</h2>
                  <p className="sectionSubtitle">info@luxury-obsession.ch</p>
                  <p className="pricingNote">
                    Data sources: <code>{DATA.booking}</code>, <code>{DATA.coupon}</code>, <code>{DATA.package}</code>.
                    For Excel loading to work, serve the site over https (GitHub Pages or any web server).
                  </p>
                </div>
              </section>
            </main>

            <footer>
              <div className="container footerInner">
                <div>¬© {new Date().getFullYear()} {t.footerA}</div>
                <div>{t.footerB}</div>
              </div>
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
