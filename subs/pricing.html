<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Luxury Obsession | Garage & Pricing</title>
  <meta name="description" content="Ferrari only experiences. Explore the garage, packages, and options. Package pricing is loaded from ../data/package.xlsx." />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="../images/image00600.jpg" />
  <style>
    :root{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;--bg:#050509;--accent:#e50914;--text:#f5f5f5;--muted:#a3a3a3;--border:#262637;--radius:18px;--shadow:0 18px 45px rgba(0,0,0,0.4);--max:1120px}
    *{box-sizing:border-box} body{margin:0;background:radial-gradient(circle at top,#191621 0,var(--bg) 55%);color:var(--text)} a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(12px);background:linear-gradient(to bottom,rgba(5,5,9,0.92),rgba(5,5,9,0.62),transparent);border-bottom:1px solid rgba(255,255,255,0.03)}
    .container{max-width:var(--max);margin:0 auto;padding:0 1.5rem}
    .navInner{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:0.75rem 0}
    .brand{display:inline-flex;align-items:center;gap:0.75rem;font-size:0.95rem;letter-spacing:0.16em;text-transform:uppercase}
    .brandMark{width:30px;height:30px;border-radius:999px;background:radial-gradient(circle at 30% 30%,#ff5a5a,#7b0209);box-shadow:0 0 20px rgba(229,9,20,0.7);display:grid;place-items:center;font-weight:850;font-size:0.8rem}
    .navRight{display:flex;align-items:center;gap:0.65rem}
    .navLinks{display:flex;align-items:center;gap:0.8rem;font-size:0.9rem}
    .navLinks a{padding:0.35rem 0.65rem;border-radius:999px;color:var(--muted)}
    .navLinks a:hover{color:var(--text);background:rgba(255,255,255,0.05)}
    .navCta{padding:0.45rem 0.9rem;border-radius:999px;background:var(--accent);font-size:0.85rem;font-weight:800;color:#fff;box-shadow:0 10px 26px rgba(229,9,20,0.45)}
    .langPicker{display:inline-flex;align-items:center;gap:0.35rem}
    .flagBtn{border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04);border-radius:999px;padding:0.25rem 0.45rem;cursor:pointer;font-size:1rem;line-height:1;opacity:0.75}
    .flagBtn.active{opacity:1;border-color:rgba(229,9,20,0.55);box-shadow:0 0 0 1px rgba(229,9,20,0.25)}
    .hamburger{display:none;width:42px;height:38px;border-radius:999px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04);cursor:pointer;align-items:center;justify-content:center}
    .hamburgerLines{display:grid;gap:4px} .hamburgerLines span{width:18px;height:2px;border-radius:999px;background:rgba(245,245,245,0.92);display:block}
    .mobileMenu{margin:0.65rem 0 0.95rem;padding:0.85rem;border-radius:16px;background:rgba(5,5,9,0.92);border:1px solid rgba(255,255,255,0.10);box-shadow:var(--shadow)}
    .mobileMenu a{display:flex;align-items:center;justify-content:space-between;padding:0.7rem 0.75rem;border-radius:12px}
    .mobileMenu a:hover{background:rgba(255,255,255,0.05)}
    .mobileMenuDivider{height:1px;background:rgba(255,255,255,0.08);margin:0.55rem 0}
    .mobileMenuCta{display:flex;justify-content:center;padding:0.75rem 0.85rem;border-radius:14px;background:var(--accent);font-weight:800;color:#fff;box-shadow:0 10px 26px rgba(229,9,20,0.45)}
    main{padding:3rem 0 2.8rem} section{padding:2.4rem 0}
    .containerNarrow{max-width:980px;margin:0 auto;padding:0 1.5rem}
    h1{margin:0;font-size:clamp(2rem,2.6vw + 1rem,3rem)} p{color:var(--muted);line-height:1.7}
    .grid2{display:grid;grid-template-columns:1.15fr 0.85fr;gap:1.2rem;margin-top:1.8rem}
    .card{background:radial-gradient(circle at top left,#151520,#050509 55%);border-radius:var(--radius);border:1px solid var(--border);padding:1.3rem;box-shadow:var(--shadow)}
    .cars{display:grid;gap:0.9rem}
    .carRow{display:grid;grid-template-columns:1.2fr auto;gap:0.75rem;align-items:center;padding:0.95rem 1rem;border-radius:16px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02)}
    .carName{font-weight:900} .pill{font-size:0.72rem;padding:0.2rem 0.6rem;border-radius:999px;border:1px solid rgba(255,255,255,0.10);background:rgba(255,255,255,0.04)}
    .pillAvail{background:rgba(229,9,20,0.16);border-color:rgba(229,9,20,0.35);color:#ffb4b4}
    .pillSoon{opacity:0.7}
    img.model{width:100%;height:100%;min-height:260px;object-fit:cover;border-radius:22px;border:1px solid rgba(255,255,255,0.10)}
    table{width:100%;border-collapse:collapse;margin-top:0.9rem;font-size:0.9rem} th,td{padding:0.75rem 0.55rem;border-bottom:1px solid rgba(255,255,255,0.08);text-align:left}
    th{color:var(--muted);font-weight:700} .price{font-weight:900}
    .gallery{margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:0.8rem}
    .gallery img{width:100%;height:150px;object-fit:cover;border-radius:16px;border:1px solid rgba(255,255,255,0.10)}
    footer{border-top:1px solid rgba(255,255,255,0.08);padding:1.5rem 0;font-size:0.78rem;color:var(--muted)}
    .footerInner{display:flex;flex-wrap:wrap;justify-content:space-between;gap:1rem}
    @media(max-width:980px){.grid2{grid-template-columns:1fr}}
    @media(max-width:760px){.navLinks{display:none}.hamburger{display:inline-flex}.container,.containerNarrow{padding:0 1rem}}
  </style>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    const DATA = { packages: new URL("../data/package.xlsx", window.location.href).toString() };
    const CARS = [
      { id: "458", name: "Ferrari 458 Italia", status: "available", image: "../images/image00100.jpg" },
      { id: "portofino", name: "Ferrari Portofino", status: "soon", image: "../images/image00200.jpg" },
      { id: "296", name: "Ferrari 296 Spider", status: "soon", image: "../images/image00300.jpg" }
    ];

    const I18N = {
      en: { home:"Home", garage:"Garage", packages:"Packages", blog:"Blog", request:"Request date" },
      de: { home:"Home", garage:"Garage", packages:"Pakete", blog:"Blog", request:"Datum anfragen" },
      it: { home:"Home", garage:"Garage", packages:"Pacchetti", blog:"Blog", request:"Richiedi data" }
    };

    function getParam(name){ const p = new URLSearchParams(window.location.search); return p.get(name); }
    function setParamReplace(name,value){ const u=new URL(window.location.href); if(!value) u.searchParams.delete(name); else u.searchParams.set(name,value); window.history.replaceState({}, "", u.toString()); }
    function readLang(){ const u=getParam("lang"); if(u && I18N[u]) return u; const s=localStorage.getItem("lo_lang"); if(s && I18N[s]) return s; return "en"; }
    function buildUrl(path, lang, hash){ const u=new URL(path, window.location.href); u.searchParams.set("lang", lang); if(hash) u.hash=hash; return u.pathname + u.search + u.hash; }

    function useExcel(urlStr, mapRowFn){
      const [data,setData]=useState(null);
      const [loaded,setLoaded]=useState(false);
      const [error,setError]=useState("");
      useEffect(() => {
        let cancelled=false;
        async function load(){
          try{
            const url = new URL(urlStr);
            url.searchParams.set("ts", String(Date.now()));
            const res = await fetch(url.toString(), { cache: "no-store" });
            if(!res.ok) throw new Error(`HTTP ${res.status} while fetching ${url.toString()}`);
            const buf = await res.arrayBuffer();
            const wb = window.XLSX.read(buf, { type:"array" });
            const ws = wb.Sheets[wb.SheetNames[0]];
            const rows = window.XLSX.utils.sheet_to_json(ws, { defval:"" });
            const out = rows.map(mapRowFn).filter(Boolean);
            if(!cancelled){ setData(out); setLoaded(true); setError(""); }
          }catch(e){
            if(!cancelled){ setData(null); setLoaded(true); setError(String(e?.message || e)); }
          }
        }
        load();
        return () => { cancelled=true; }
      }, [urlStr]);
      return { data, loaded, error };
    }

    function usePackages(){
      const fallback = [
        { package_id:"P6_L", duration:"6h", km:"80", pricing_chf:790, label_en:"Signature Half Day", label_de:"Signature Halbtag", label_it:"Signature Mezza giornata", sort_order:10 }
      ];
      const { data, loaded, error } = useExcel(DATA.packages, (row) => {
        const id = String(row.package_id ?? row.id ?? "").trim();
        if(!id) return null;
        const active = String(row.active ?? "").trim().toUpperCase();
        if(active === "N") return null;
        const price = Number(row.pricing_chf ?? "");
        const sort = Number(row.sort_order ?? 9999);
        return {
          package_id: id,
          duration: String(row.duration ?? "").trim(),
          km: String(row.km ?? "").trim(),
          pricing_chf: Number.isFinite(price) ? price : null,
          label_en: String(row.label_en ?? "").trim(),
          label_de: String(row.label_de ?? "").trim(),
          label_it: String(row.label_it ?? "").trim(),
          sort_order: Number.isFinite(sort) ? sort : 9999
        };
      });
      const packages = useMemo(() => {
        const src = (data && data.length) ? data : fallback;
        return [...src].sort((a,b) => (a.sort_order ?? 9999) - (b.sort_order ?? 9999));
      }, [data]);
      return { packages, loaded, error };
    }

    function LanguagePicker({ lang, onChange }){
      const items = [
        { code:"en", flag:"ðŸ‡¬ðŸ‡§" },
        { code:"de", flag:"ðŸ‡©ðŸ‡ª" },
        { code:"it", flag:"ðŸ‡®ðŸ‡¹" }
      ];
      return (
        <div className="langPicker">
          {items.map(it => (
            <button key={it.code} className={it.code === lang ? "flagBtn active":"flagBtn"} onClick={() => onChange(it.code)} type="button">
              {it.flag}
            </button>
          ))}
        </div>
      );
    }

    function Nav({ lang, setLang }){
      const t = I18N[lang] || I18N.en;
      const [open,setOpen]=useState(false);
      const close=() => setOpen(false);

      return (
        <header>
          <div className="container">
            <div className="navInner">
              <a href={buildUrl("../home.html", lang, "top")} className="brand"><div className="brandMark">LO</div><span>Luxury Obsession</span></a>
              <div className="navRight">
                <nav className="navLinks">
                  <a href={buildUrl("../home.html", lang, "top")}>{t.home}</a>
                  <a href={buildUrl("pricing.html", lang, "garage")}>{t.garage}</a>
                  <a href={buildUrl("pricing.html", lang, "packages")}>{t.packages}</a>
                  <a href={buildUrl("blog.html", lang)}>{t.blog}</a>
                  <a href={buildUrl("../home.html", lang, "booking")} className="navCta">{t.request}</a>
                </nav>
                <LanguagePicker lang={lang} onChange={(x) => { setLang(x); close(); }} />
                <button type="button" className="hamburger" onClick={() => setOpen(v => !v)} aria-label="menu">
                  <div className="hamburgerLines"><span></span><span></span><span></span></div>
                </button>
              </div>
            </div>

            {open && (
              <div className="mobileMenu">
                <a href={buildUrl("../home.html", lang, "top")} onClick={close}>{t.home}<span>â€º</span></a>
                <a href={buildUrl("pricing.html", lang, "garage")} onClick={close}>{t.garage}<span>â€º</span></a>
                <a href={buildUrl("pricing.html", lang, "packages")} onClick={close}>{t.packages}<span>â€º</span></a>
                <a href={buildUrl("blog.html", lang)} onClick={close}>{t.blog}<span>â€º</span></a>
                <div className="mobileMenuDivider"></div>
                <a className="mobileMenuCta" href={buildUrl("../home.html", lang, "booking")} onClick={close}>{t.request}</a>
              </div>
            )}
          </div>
        </header>
      );
    }

    function App(){
      const [lang,_setLang]=useState(readLang());
      const pack = usePackages();
      const [carId,setCarId]=useState("458");
      const car = useMemo(() => CARS.find(c => c.id === carId) || CARS[0], [carId]);
      const labelKey = `label_${lang}`;

      useEffect(() => {
        localStorage.setItem("lo_lang", lang);
        document.documentElement.lang = lang;
        setParamReplace("lang", lang);
      }, [lang]);

      function setLang(next){ if(!I18N[next]) return; _setLang(next); }

      return (
        <div>
          <Nav lang={lang} setLang={setLang} />

          <main>
            <section id="garage">
              <div className="containerNarrow">
                <h1>Garage and pricing</h1>
                <p>Package pricing is loaded from <code>{DATA.packages}</code>. Ferrari 458 Italia is available now; other models are coming soon.</p>

                <div className="grid2">
                  <div className="card">
                    <h3 style={{ marginTop: 0 }}>Choose your Ferrari</h3>
                    <div className="cars">
                      {CARS.map(c => {
                        const isSoon = c.status !== "available";
                        return (
                          <div key={c.id} className="carRow" style={{ opacity: isSoon ? 0.55 : 1, cursor: isSoon ? "not-allowed" : "pointer" }} onClick={() => !isSoon && setCarId(c.id)}>
                            <div>
                              <div className="carName">{c.name}</div>
                              <div style={{ marginTop:"0.15rem", fontSize:"0.82rem", color:"var(--muted)" }}>{isSoon ? "Coming soon" : "Available now"}</div>
                            </div>
                            <span className={isSoon ? "pill pillSoon" : "pill pillAvail"}>{isSoon ? "Soon" : "Available"}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div>
                    <img className="model" src={car.image} alt={car.name} />
                    <p style={{ marginTop:"0.6rem" }}>3D style display placeholder. Replace with an actual WebGL or Three.js model later.</p>
                  </div>
                </div>

                <div className="card" style={{ marginTop:"1.2rem" }}>
                  <h3 style={{ marginTop: 0 }} id="packages">Packages</h3>
                  {!pack.loaded ? (
                    <p>Loading packagesâ€¦</p>
                  ) : (
                    <table>
                      <thead>
                        <tr><th>Package</th><th>Duration</th><th>Km</th><th>Price</th></tr>
                      </thead>
                      <tbody>
                        {pack.packages.map(p => (
                          <tr key={p.package_id}>
                            <td><strong>{(p[labelKey] || p.label_en || p.package_id).split(" Â· ")[0]}</strong><div style={{ color:"var(--muted)", marginTop:"0.2rem" }}>{p.package_id}</div></td>
                            <td>{p.duration}</td>
                            <td>{String(p.km).toLowerCase() === "unlimited" ? "Unlimited" : `${p.km} km`}</td>
                            <td className="price">{p.pricing_chf} CHF</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  )}
                  {pack.error ? <p style={{ color:"var(--muted)" }}>Could not load {DATA.packages}. Using fallback.</p> : null}
                </div>

                <div className="card" style={{ marginTop:"1.2rem" }}>
                  <h3 style={{ marginTop: 0 }}>Gallery</h3>
                  <div className="gallery">
                    <img src="../images/image00100.jpg" alt="gallery" />
                    <img src="../images/image00200.jpg" alt="gallery" />
                    <img src="../images/image00300.jpg" alt="gallery" />
                    <img src="../images/image00400.jpg" alt="gallery" />
                    <img src="../images/image00500.jpg" alt="gallery" />
                  </div>
                </div>

                <div className="card" style={{ marginTop:"1.2rem" }}>
                  <h3 style={{ marginTop: 0 }}>Terms and options</h3>
                  <table>
                    <tbody>
                      <tr><th>Deposit</th><td>Example: 2,000 CHF refundable deposit.</td></tr>
                      <tr><th>Extra mileage</th><td>Example: 5 CHF per extra km (adjust as needed).</td></tr>
                      <tr><th>Options</th><td>Example: Concierge pickup, second driver, child seat.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </section>
          </main>

          <footer>
            <div className="container footerInner">
              <div>Â© {new Date().getFullYear()} Luxury Obsession.</div>
              <div>Ferrari only experiences, Switzerland.</div>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
